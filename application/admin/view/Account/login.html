<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>后台用户登录</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <meta content="Preview page of Metronic Admin Theme #3 for " name="description" />
    <meta content="" name="author" />

    <link href="{$template}/global/plugins/google-fonts/css/google-fonts.css" rel="stylesheet" type="text/css" />
    <link href="{$template}/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <link href="{$template}/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css" />
    <link href="{$template}/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="{$template}/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css" rel="stylesheet" type="text/css" />
    <!-- END GLOBAL MANDATORY STYLES -->
    <!-- BEGIN PAGE LEVEL PLUGINS -->
    <link href="{$template}/global/plugins/select2/css/select2.min.css" rel="stylesheet" type="text/css" />
    <link href="{$template}/global/plugins/select2/css/select2-bootstrap.min.css" rel="stylesheet" type="text/css" />
    <!-- END PAGE LEVEL PLUGINS -->
    <!-- BEGIN THEME GLOBAL STYLES -->
    <link href="{$template}/global/css/components.min.css" rel="stylesheet" id="style_components" type="text/css" />
    <link href="{$template}/global/css/plugins.min.css" rel="stylesheet" type="text/css" />
    <!-- END THEME GLOBAL STYLES -->
    <!-- BEGIN PAGE LEVEL STYLES -->
    <link href="{$template}/pages/css/login-4.min.css" rel="stylesheet" type="text/css" />
    <!-- END PAGE LEVEL STYLES -->
    <!-- BEGIN THEME LAYOUT STYLES -->
    <!-- END THEME LAYOUT STYLES -->
    <link rel="shortcut icon" href="favicon.ico" /> </head>
<body class=" login">
<!-- BEGIN LOGO -->
<div class="logo">

</div>
<!-- END LOGO -->
<!-- BEGIN LOGIN -->
<div class="content">
    <!-- BEGIN LOGIN FORM -->
    <div class="alert alert-danger display-hide" id="user-check">
        <button class="close" data-close="alert"></button>
        <span> 用户名不能为空. </span>
    </div>
    <div class="alert alert-danger display-hide" id="password-check">
        <button class="close" data-close="alert"></button>
        <span> 密码不能为空. </span>
    </div>
    <div class="alert alert-danger display-hide" id="login-error">
        <button class="close" data-close="alert"></button>
        <span id="errorTip"> </span>
    </div>
    <div class="alert alert-danger display-hide" id="verify-check">
        <button class="close" data-close="alert"></button>
        <span> 验证码不能为空. </span>
    </div>
    <div class="alert alert-danger display-hide" id="verify-tips">
        <button class="close" data-close="alert"></button>
        <span> 验证码输入有误！</span>
    </div>

        <h3 class="form-title">后台登陆</h3>
        <div class="alert alert-danger display-hide">
            <button class="close" data-close="alert"></button>
            <span> 后台登陆 </span>
        </div>
        <div class="form-group">
            <!--ie8, ie9 does not support html5 placeholder, so we just show field title for that-->
            <label class="control-label visible-ie8 visible-ie9">Username</label>
            <div class="input-icon">
                <i class="fa fa-user"></i>
                <input class="form-control placeholder-no-fix" type="text" autocomplete="off" placeholder="Username" name="username" id="username"/> </div>
        </div>
        <div class="form-group">
            <label class="control-label visible-ie8 visible-ie9">Password</label>
            <div class="input-icon">
                <i class="fa fa-lock"></i>
                <input class="form-control placeholder-no-fix" type="password" autocomplete="off" placeholder="Password" name="password" id="password"/> </div>
        </div>
        <div class="form-group">
            <label class="control-label visible-ie8 visible-ie9">验证码</label>
            <input class="form-control form-control-solid placeholder-no-fix"
                   style="width: 50%;display: inline-block;color: mediumseagreen;font-weight: 600" type="text"
                   autocomplete="off" placeholder="验证码" id="verify"/>
            <img class="verifyimg reloadverify" style="float: right; margin-left: 5px" title="点我切换验证码^-^"
                 src="{:captcha_src('', ['imageH'])}">
        </div>
        <div class="form-actions">

            <button type="submit" id="loginBtn" class="btn green pull-right"> 登陆 </button>
        </div>
</div>
<div class="copyright"> 2016 © 尖塔科技 </div>

<script src="{$template}/global/plugins/jquery.min.js" type="text/javascript"></script>
<script src="{$template}/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<script src="{$template}/global/plugins/js.cookie.min.js" type="text/javascript"></script>
<script src="{$template}/global/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
<script src="{$template}/global/plugins/jquery.blockui.min.js" type="text/javascript"></script>
<script src="{$template}/global/plugins/bootstrap-switch/js/bootstrap-switch.min.js" type="text/javascript"></script>
<!-- END CORE PLUGINS -->
 <!-- BEGIN PAGE LEVEL PLUGINS -->
        <script src="{$template}/global/plugins/jquery-validation/js/jquery.validate.min.js" type="text/javascript"></script>
        <script src="{$template}/global/plugins/jquery-validation/js/additional-methods.min.js" type="text/javascript"></script>
        <script src="{$template}/global/plugins/select2/js/select2.full.min.js" type="text/javascript"></script>
        <script src="{$template}/global/plugins/backstretch/jquery.backstretch.min.js" type="text/javascript"></script>
        <!-- END PAGE LEVEL PLUGINS -->
<!-- BEGIN THEME GLOBAL SCRIPTS -->
<script src="{$template}/global/scripts/app.min.js" type="text/javascript"></script>
<!-- END THEME GLOBAL SCRIPTS -->
<!-- BEGIN PAGE LEVEL SCRIPTS -->
     <script src="{$template}/pages/scripts/login-4.min.js" type="text/javascript"></script>
<!-- END PAGE LEVEL SCRIPTS -->
<!-- BEGIN THEME LAYOUT SCRIPTS -->
<!-- END THEME LAYOUT SCRIPTS -->
</body>

<script type="text/javascript">
    var verifyimg = $(".verifyimg").attr("src");
    $(".reloadverify").click(function () {
        if (verifyimg.indexOf('?') > 0) {
            $(".verifyimg").attr("src", verifyimg + '&random=' + Math.random());
        } else {
            $(".verifyimg").attr("src", verifyimg.replace(/\?.*$/, '') + '?' + Math.random());
        }
    });

    $('#username').blur(function () {
        if ($(this).val() == '') {
            $('#user-check').show(1000);
        } else {
            $('#user-check').hide(1000);
        }
    });

    $('#password').blur(function () {
        if ($(this).val() == '') {
            $('#password-check').show(1000);
        } else {
            $('#password-check').hide(1000);
        }
    });

    $('#verify').blur(function () {
        if ($(this).val() == '') {
            $('#verify-check').show(1000);
        } else {
            $('#verify-check').hide(1000);
        }
    });

     $("#loginBtn").click(function () {
         $.ajax({
             type: "POST",
             url: "/admin/Account/checkVerify",
             dataType: "json",
             data: {
                 verify: $('#verify').val()
             },
             success: function (rJson) {
                 if (rJson.success === false) {
                     $("#verify-tips").slideDown();
                     $(".verifyimg").attr("src", verifyimg.replace(/\?.*$/, '') + '?' + Math.random());
                 } else {
                     $.ajax({
                         type: "POST",
                         url: "/admin/Account/checkLogin",
                         dataType: "json",
                         data: {
                             username: $('#username').val(),
                             password: $('#password').val()
                         },
                         success: function (rJson) {

                             if (rJson.success === false) {
                                 $('#errorTip').text(rJson.data.error);
                                 $("#login-error").slideDown();
                             }else{

                                 location.href= "/admin/Index/index";
                             }

                         }
                     });
                 }
             }
         });
     });

    $('#verify').keypress(function(e) {
        // 回车键事件
        if(e.which == 13) {
            $("#loginBtn").click();
        }
    });
</script>
</html>